# CHAPTER 1 – IPv4/IPv6 Addressing & Routing Review

# 1. FUNDAMENTOS DE DIRECCIONAMIENTO IPv4  

## 1.1 Estructura formal de una dirección IPv4

Una dirección IPv4 es un número binario de 32 bits:

```
xxxxxxxx.xxxxxxxx.xxxxxxxx.xxxxxxxx
```

Representado en notación decimal con puntos:

```
w.x.y.z
```

### División lógica

```
[ NETWORK BITS | HOST BITS ]
```

La máscara determina cuántos bits corresponden a la “porción de red”.

Ejemplo técnico:

```
Dirección: 172.16.18.75 
Máscara:   255.255.240.0 (/20)
```

Interpretación del /20:

```
11111111.11111111.11110000.00000000
```

Red resultante:

```
172.16.16.0 – 172.16.31.255
```

---

## 1.2 Origen de las clases IPv4 (contexto histórico útil)

Antes de CIDR, las direcciones se asignaban por clases:

```
Clase A: 0.0.0.0 – 127.255.255.255     /8 
Clase B: 128.0.0.0 – 191.255.255.255   /16 
Clase C: 192.0.0.0 – 223.255.255.255   /24
```

Problema:

- Una empresa que necesitaba 5,000 hosts recibía una **Clase B (/16)** → desperdicio masivo.
    

Solución:

- **CIDR (RFC 1519)** → permite máscaras variables y agregación de rutas.
    

---

## 1.3 El problema de agotamiento de IPv4

Causas principales:

1. Asignación ineficiente por clases
    
2. Expansión masiva de Internet
    
3. Crecimiento de dispositivos móviles
    
4. ISPs asignando bloques demasiado grandes inicialmente
    

Solución:

- NAT44, CGNAT, CIDR, y finalmente **IPv6**.
    

---

## 1.4 Subnetting profundo (visión CCNP)

Subnetting es la técnica de dividir una red mayor en redes más pequeñas usando máscaras más largas.

Ejemplo explicativo:

```
10.0.0.0/8 dividido en /20
```

Número de subredes:

```
Subnets = 2^(new_bits) = 2^(20 - 8) = 4096
```

Hosts por subred:

```
2^(32 - 20) - 2 = 4094
```

---

## 1.5 Subnetting inverso (supernetting)

Agrupación de redes contiguas para reducir rutas:

```
192.168.0.0/24 
192.168.1.0/24 
192.168.2.0/24 
192.168.3.0/24
```

Se agregan como:

```
192.168.0.0/22
```

Esto es **fundamental en BGP**.

---
# 2. DHCP PARA IPv4 – OPERACIONES INTERNAS

## 2.1 DORA explicado a profundidad

DHCP opera sobre broadcast porque el cliente no conoce todavía su propio IP.

```
DISCOVER → Cliente anuncia necesidad de configuración
OFFER    → Servidor propone IP
REQUEST  → Cliente confirma la oferta seleccionada
ACK      → Servidor finaliza el proceso
```

### Internamente

DHCP asigna:

- Dirección IP
    
- Máscara
    
- Default Gateway
    
- DNS
    
- Tiempo de lease
    
- Opciones adicionales (VOIP, PXE boot, TFTP, etc.)
    

---

## 2.2 Campos importantes en DHCP (profundo)

DHCP utiliza el BOOTP header, incluyendo:

- Transaction ID (XID)
    
- GIADDR (gateway IP address)
    
- CHADDR (client hardware address)
    
- Options (DNS, MTU, Router, etc.)
    

---

## 2.3 DHCP Relay – Cómo funciona realmente

Cuando un cliente está en otra VLAN:

1. Cliente envía **broadcast**
    
2. Switch/Router intercepta y encapsula en un **unicast al servidor**
    
3. Rellena el campo **giaddr**
    
4. Servidor responde al relay, NO al cliente directamente
    
5. Relay reenvía al cliente como broadcast local
    

Comando:

```
ip helper-address <IP del servidor DHCP>
```

---

## 2.4 Troubleshooting DHCP avanzado

### Fallas típicas
- VLAN incorrecta
- SVI apagado
- DHCP Snooping bloquea paquetes
- Rutas faltantes hacia el servidor
- Pool sin direcciones disponibles

### CLI profundo

```
debug ip dhcp server events
debug ip dhcp server packet
show ip dhcp conflict
show ip dhcp binding
show ip interface <int>
```

---
# 3. IPv6 ADDRESSING – PROFUNDIDAD CCNP

## 3.1 Estructura formal de direcciones IPv6

```
128 bits → 8 bloques hexadecimales de 16 bits
```

Notación:

```
2001:0DB8:ACAD:0001:0000:0000:0000:0050
```

### Compresión de IPv6 correctamente

1. Ceros a la izquierda pueden omitirse:
    
```
 0001 → 1
```
    
2. Secuencias largas de ceros pueden colapsarse con ::
    

```
2001:DB8:ACAD:1::50
```

Solo puede usarse **una vez por dirección**.

---

## 3.2 Tipos de direcciones IPv6

### 1. Global Unicast (2000::/3)

Equivalente a públicas IPv4.

### 2. Link-Local (FE80::/10)

Siempre presentes.  
No rutables.  
Usadas en:

- ND (Neighbor Discovery)
    
- OSPFv3
    
- EIGRP for IPv6
    
- BGP next-hop en entornos IPv6-only
    

### 3. Unique Local (FC00::/7)

Privadas, no en Internet.  
Equivalente a RFC1918.

### 4. Multicast (FF00::/8)

Importante:

- ff02::1 → all nodes
    
- ff02::2 → all routers
    
- ff02::5 → OSPFv3
    
- ff02::a → EIGRPv6
    

---

## 3.3 EUI-64 – Explicación para examen

Dado:

```
MAC: AA-BB-CC-DD-EE-FF
```

Se divide:

```
AA-BB-CC FFFE DD-EE-FF
```

El 7th bit se invierte:

- Bit original: 0 → local
    
- Bit cambiado: 1 → global  
    o viceversa
    

---

## 3.4 SLAAC – cómo decide el host su dirección

Proceso:

1. Router envía RA (Router Advertisement)
    
2. Host toma el prefijo (ej: /64)
    
3. Genera su host ID (EUI-64 o aleatorio)
    
4. Realiza DAD (Duplicate Address Detection)
    
5. Instala dirección global
    

---
# 4. DHCPv6 – PROFUNDIDAD PROFESIONAL

## 4.1 Flags M y O (Managed y Other)

Definen comportamiento del host:

```
M=0/O=0 → solo SLAAC
M=0/O=1 → SLAAC + DNS vía DHCPv6 stateless
M=1/O=0 → Stateful DHCPv6 (DHCPv6 asigna IP)
M=1/O=1 → Stateful DHCPv6 + info adicional
```

---

## 4.2 Operación DHCPv6 en detalle

Mensajes:

```
SOLICIT → Cliente busca servidores
ADVERTISE → Servidor ofrece parámetros
REQUEST → Cliente confirma selección
REPLY → Servidor confirma
```

---
# 5. PACKET FORWARDING PROCESS (CEF PROFUNDO)

## 5.1 FIB vs RIB

### RIB (Routing Information Base)

- Tabla de routing
    
- Contiene todas las rutas conocidas
    
- Estructura lógica
    

### FIB (Forwarding Information Base)

- Construida por CEF
    
- Contiene solo la _mejor_ ruta
    
- Optimizada para reenvío
    

---

## 5.2 Adjacency Table

Define cómo llegar al next-hop:

Tipos:

- ARP adjacency
    
- Glean adjacency
    
- Drop adjacency
    
- Null adjacency
    
- Punt adjacency
    

Ejemplo CLI:

```
show adjacency detail
```

---
# 6. ADMINISTRATIVE DISTANCE – ANÁLISIS PROFUNDO

## 6.1 Qué es realmente la AD

Es el **índice de confiabilidad** de la **fuente** de información de routing, NO de la ruta.

Prioridad:

```
CONNECTED → 0
STATIC → 1
eBGP → 20
EIGRP internal → 90
OSPF → 110
RIP → 120
EIGRP external → 170
iBGP → 200
```

---

# 7. RUTAS ESTÁTICAS Y SU RESOLUCIÓN EN IOS

## 7.1 Instalación de rutas estáticas – condiciones

Para instalar una ruta estática:

1. El next-hop debe ser **alcanzable**
    
2. Debe tener AD **más baja** que alternativas
    
3. Si next-hop no está en ARP → _resolución diferida_
    

---

## 7.2 Rutas estáticas IPv4 – CLI

```
ip route 10.10.10.0 255.255.255.0 192.168.1.1
```

Ruta estática flotante:

```
ip route 10.10.10.0 255.255.255.0 192.168.1.1 200
```

---
# 8. TROUBLESHOOTING PROFUNDO – TROUBLE TICKETS

## TT 1-1 – Subnetting incorrecto

Síntomas:

- Hosts en VLAN sin comunicación
    
- DHCP entrega direcciones fuera de rango
    

Diagnóstico:

```
show ip interface
show running-config | section interface
```

---

## TT 1-2 – DHCP no asigna direcciones

Causas:

- Falta helper-address
    
- ACL bloquea UDP 67/68
    
- DHCP Snooping
    
- Servidor sin alcance
    

---

## TT 1-3 – SLAAC no genera dirección

Causa típica:

```
ipv6 unicast-routing
```

desactivado en el router.

---

## TT 1-4 – EUI-64 incorrecto

Solución:

- Verificar MAC
    
- Ver “ipv6 address … eui-64”
    

---

## TT 1-5 – Ruta estática no entra al RIB

Requisitos:

1. Next-hop debe existir en RIB
    
2. Si la ruta coincide con otra más específica → NO se instala
    

---

## TT 1-6 – Ruta está pero tráfico no fluye

Causas:

- ARP/ND incompleto
    
- ACL bloqueando
    
- CEF inconsistente
    

Comandos:

```
show ip cef exact-route <src> <dst>
show adjacency detail
```


# ```
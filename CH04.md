# Chapter 4 – Troubleshooting EIGRP for IPv4
## ENARSI Deep Technical Notes

---

# 1. Troubleshooting EIGRP for IPv4 Neighbor Adjacencies

EIGRP requiere:
- Enlaces Layer 3 operativos.
- Misma AS.
- Misma subnet.
- Mismos K-values.
- Autenticación coincidente.
- Timers razonables.
- No estar en modo passive.
- No estar bloqueado por ACLs.

Comandos principales:
```
show ip eigrp neighbors
show ip eigrp interfaces detail
debug eigrp packets hello
debug eigrp neighbors
```

---

## 1.1 Interface Is Down

Si la interfaz está DOWN, no se formará vecindad.

Verificación:
```
show ip interface brief
show interfaces g0/0
```

Acciones:
- Revisar capas 1/2.
- `no shutdown`.
- Revisar encapsulación en serial:
```
show interfaces serial0/0 encapsulation
```

---

## 1.2 Mismatched Autonomous System Numbers

Routers deben usar el mismo AS:
```
router eigrp 100
```

Si uno usa 100 y otro 200:
- No se ven.
- No hay Hellos compatibles.

Ver:
```
show ip protocols
```

---

## 1.3 Incorrect Network Statement

Un router puede no enviar Hellos por un enlace si no está cubierto por el network.

Ejemplo:
```
router eigrp 100
 network 10.1.1.0 0.0.0.255
```

Si el enlace es 10.2.2.0/30 → no se anuncia.

Verificación:
```
show ip eigrp interfaces
```

---

## 1.4 Mismatched K Values

Los parámetros de métrica deben coincidir exactamente entre vecinos.

Verificación:
```
show ip protocols | include K
```

Resultado típico:
```
K1=1, K2=0, K3=1, K4=0, K5=0
```

Si no coinciden:
- Vecindad rechazada.

Mensaje típico:
```
%DUAL-5-NBRCHANGE: K-values mismatch
```

---

## 1.5 Passive Interface

El router no envía Hellos por una interfaz en modo passive.

Verificación:
```
show ip protocols
```

Arreglo:
```
router eigrp 100
 no passive-interface g0/1
```

---

## 1.6 Different Subnets

EIGRP solo forma vecinos dentro de la misma subnet.

Verificación:
```
show ip interface g0/0
```

Problemas típicos:
- Interfaces mal configuradas.
- /30 vs /24 inconsistente.

---

## 1.7 Authentication

Si la autenticación no coincide, no habrá adyacencia.

Configuración típica:
```
key chain EIGRP_KEYS
 key 1
  key-string cisco123

interface g0/0
 ip authentication mode eigrp 100 md5
 ip authentication key-chain eigrp 100 EIGRP_KEYS
```

Verificación:
```
debug eigrp packets hello
```

---

## 1.8 ACLs

Una ACL puede bloquear tráfico EIGRP multicast (224.0.0.10).

EIGRP usa:
- IPv4: Protocol 88.

Debes permitir:
```
permit eigrp any any
```

---

## 1.9 Timers

No es obligatorio que coincidan entre vecinos, pero pueden generar falsos positivos.

Verificación:
```
show ip eigrp neighbors
```

Si aparece flapping:
- Ajustar Hello y Hold timers.

---

# 2. Troubleshooting EIGRP for IPv4 Routes

---

## 2.1 Bad or Missing network Command

Si se configuran interfaces como passive o no están dentro de los network statements, EIGRP no las anunciará.

Verificación:
```
show ip eigrp topology
show ip protocols
```

---

## 2.2 Better Source of Information

Si un router aprende una ruta preferida por otra fuente (ej. static, OSPF), EIGRP no la instala.

Recordatorio AD:
- Connected = 0
- Static = 1
- EIGRP Internal = 90
- EIGRP External = 170
- OSPF = 110
- RIP = 120

Diagnóstico:
```
show ip route <prefix>
```

---

## 2.3 Route Filtering

Posibles filtros:
- Distribute lists
- Route maps
- Prefix lists

Ejemplo:
```
router eigrp 100
 distribute-list prefix BLOCK out g0/1

ip prefix-list BLOCK deny 172.16.0.0/16
ip prefix-list BLOCK permit 0.0.0.0/0 le 32
```

---

## 2.4 Stub Configuration

Un router configurado como stub **no redistribuye** rutas aprendidas desde otros dominios.

Verificación:
```
show ip eigrp neighbors detail
```

Mensaje típico:
```
EIGRP neighbor is a stub peer
```

---

## 2.5 Interface Is Shut Down

Si una interfaz está administrativamente apagada:
```
interface g0/2
 shutdown
```

El router deja de participar en EIGRP por esa interfaz.

---

## 2.6 Split Horizon

Previene que EIGRP anuncie rutas aprendidas en una interfaz por la misma interfaz.

Crítico en:
- Frame Relay multipoint
- DMVPN hub/spokes

Deshabilitar:
```
interface Tunnel0
 no ip split-horizon eigrp 100
```

Verificación:
```
show ip protocols
```

---

# 3. Troubleshooting Miscellaneous EIGRP for IPv4 Issues

---

## 3.1 Feasible Successors

Si un router no tiene FS, debe ir Active cuando muere el Successor.

Esto puede causar SIA.

Verificación:
```
show ip eigrp topology
```

---

## 3.2 Discontiguous Networks and Autosummarization

Ejemplo:
```
10.1.0.0/16
10.2.0.0/16
```

Si auto-summary está activado, ambos pueden resumirse a 10.0.0.0/8 creando agujeros de ruteo.

Desactivar siempre:
```
router eigrp 100
 no auto-summary
```

---

## 3.3 Route Summarization

Problemas comunes:
- Métrica incorrecta.
- Null0 summary route descartando tráfico legítimo.
- Resumen aplicado en interfaz equivocada.

Verificación:
```
show ip route summary
show ip eigrp topology
```

---

## 3.4 Load Balancing

EIGRP realiza balanceo:
- Igual costo (ECMP)
- Diferente costo (variando con "variance")

Ejemplo:
```
router eigrp 100
 variance 2
```

Verificación:
```
show ip route
show ip eigrp topology
```

---

# 4. EIGRP for IPv4 Trouble Tickets

---

## Trouble Ticket 4-1  
**Síntoma:** No se forman adyacencias en un enlace serial.  
**Causas posibles:**
- K-values mismatch.
- Hello/Hold timers desbalanceados.
- Autenticación incorrecta.

Comandos:
```
show ip protocols
debug eigrp neighbors
```

Solución típica:
- Ajustar K-values.
- Revisar clave MD5.
- Verificar network statement.

---

## Trouble Ticket 4-2  
**Síntoma:** Rutas EIGRP no aparecen en tabla RIB.

Diagnóstico:
- AD más alto que otro protocolo.
- Filtro aplicado.
- Interfaz en passive.
- Auto-summary generando supernet errónea.

Solución:
- Ajustar AD si se requiere:
```
router eigrp 100
 distance eigrp 80 170
```

---

## Trouble Ticket 4-3  
**Síntoma:** SIA constante en enlaces WAN.

Causas:
- No existen FS.
- Queries bloqueadas.
- No se implementó stub.
- No se implementó sumarización.

Solución recomendada:
```
router eigrp 100
 eigrp stub connected summary
```

Verificación:
```
show ip eigrp topology active
```

---

# Resumen Final del Capítulo

- 90% de problemas EIGRP = network statements, AS mismatch, authentication, K-values.  
- SIA = falta de FS o problemas de flooding de queries.  
- Auto-summary casi siempre debe deshabilitarse.  
- Stub + summarization = topologías estables.  
- Split Horizon afecta DMVPN y NBMA multipoint.  
- Filtrado = recordar qué dirección (in/out) afecta qué prefijos.


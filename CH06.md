# Chapter 6 – OSPF (Advanced ENARSI Edition)

---

# 1. OSPF Fundamentals

OSPF (Open Shortest Path First) es un **protocolo link-state** basado en **Dijkstra (SPF)**.  
Características fundamentales:

- Protocolo IGP de tipo **link-state**.  
- Usa **LSAs (Link-State Advertisements)** para describir el estado de los enlaces.  
- Routers mantienen:
  - **Link-State Database (LSDB)**
  - **Routing Information Base (RIB)**
  - **Neighbor table**
- Corre directamente sobre IP, protocolo **89**.
- Soporta jerarquía con **áreas** para escalar redes grandes.

Cada router genera LSAs y los inunda a todos los routers del área, garantizando **visión sincronizada del área**.

---

# 2. Areas

OSPF permite dividir una red en áreas:

- **Área 0** (Backbone): área central obligatoria.
- **Áreas regulares**: deben conectarse siempre al backbone.
- **Áreas especiales**:
  - Stub
  - Totally Stubby
  - NSSA
  - Totally NSSA

Beneficios:
- Menos LSAs → menos cómputo SPF.
- Reducción de tamaño de LSDB.
- Estabilidad y aislamiento de fallos.

Ver área de una interfaz:
```
show ip ospf interface g0/0
```

---

# 3. Inter-Router Communication

OSPF utiliza:

- **Hello packets** (descubrimiento de vecinos)
- **Database Description (DBD)** (sincronización inicial)
- **LSR / LSU / LSAck** (intercambio de LSAs)

Secuencia de estados de vecino:
```
Down → Init → 2-Way → ExStart → Exchange → Loading → Full
```

---

# 4. Router ID

El Router-ID es un identificador único de 32 bits.

Prioridad para selección:
1. Configurado manualmente:
   ```
   router ospf 1
    router-id 1.1.1.1
   ```
2. Mayor IP en loopback
3. Mayor IP en interfaces activas

Ver Router-ID:
```
show ip ospf | include Router ID
```

---

# 5. OSPF Hello Packets

Los mensajes Hello descubren vecinos.

Parámetros críticos que deben coincidir:
- Hello interval  
- Dead interval  
- Área  
- Authentication  
- Network type  
- Stub flags  

Comando:
```
show ip ospf interface g0/0
```

---

# 6. Neighbors

Ver vecinos:
```
show ip ospf neighbor
```

Estados posibles:
- Down  
- Init  
- 2-Way  
- ExStart  
- Exchange  
- Loading  
- Full  

Estado FULL solo con DR/BDR en redes broadcast.

---

# 7. Requirements for Neighbor Adjacency

Para formar adyacencias, routers deben coincidir en:

- Area-ID  
- Authentication  
- Hello / Dead timers  
- Network type  
- Stub type  
- MTU (muy importante en troubleshooting)  

No coincidencia de MTU → se queda atascado en **ExStart/Exchange**.

Verificación:
```
show ip ospf interface g0/1 | include MTU
```

---

# 8. OSPF Configuration

Ejemplo clásico:
```
router ospf 1
 router-id 1.1.1.1
 network 10.0.0.0 0.0.0.255 area 0
```

Requiere previamente:
```
ip routing
```

---

# 9. OSPF Network Statement

Define qué interfaces participan:
```
network <IP> <wildcard> area X
```

Ejemplos:
```
network 10.1.1.0 0.0.0.255 area 0
network 172.16.0.0 0.0.255.255 area 1
```

Mostrar interfaces que coinciden con OSPF:
```
show ip ospf interface brief
```

---

# 10. Interface-Specific Configuration

Permite granularidad:

```
interface g0/0
 ip ospf 1 area 0
 ip ospf cost 10
 ip ospf network point-to-point
```

Control total sobre el comportamiento de la interfaz.

---

# 11. Passive Interfaces

Evita enviar Hellos en interfaces donde no debe haber vecinos:
```
router ospf 1
 passive-interface default
 no passive-interface g0/0
```

Verificación:
```
show ip ospf interface | include Passive
```

---

# 12. Sample Topology and Configuration

```
router ospf 1
 router-id 1.1.1.1
 network 10.0.0.0 0.0.255.255 area 0
```

Ver interfaces activas:
```
show ip ospf interface brief
```

---

# 13. Verification of OSPF Neighbor Adjacencies

```
show ip ospf neighbor
show ip ospf interface g0/0
debug ip ospf adj
```

Problemas típicos:
- Timers mismatched
- Area mismatched
- MTU mismatch
- Authentication mismatch
- Stub flags mismatch

---

# 14. Viewing OSPF Installed Routes

```
show ip route ospf
show ip ospf database
```

Tipos de rutas:
- O → intrarea  
- O IA → interarea  
- O E1/E2 → externas  

---

# 15. External OSPF Routes

Tipos de LSA externos:
- **Type 5**: External route (E1 o E2)
- **Type 7**: External (NSSA), convertido a Type 5 por ABR

Redistribución:
```
router ospf 1
 redistribute eigrp 100 subnets
```

Ver:
```
show ip ospf database external
```

---

# 16. Default Route Advertisement

Manual:
```
router ospf 1
 default-information originate
```

Forzar aunque no exista default:
```
default-information originate always
```

---

# 17. The Designated Router and Backup Designated Router

En redes multiacceso, se eligen DR y BDR para reducir LSAs.

Elección depende de:
- Priority (0 = no participar)
- Router-ID (si priority = empate)

Ver prioridad:
```
show ip ospf interface g0/1 | include Priority
```

---

# 18. DR and BDR Placement

Buenas prácticas:
- No dejar que routers débiles sean DR.
- Ajustar prioridad:
  ```
  interface g0/1
   ip ospf priority 200
  ```

Ver DR/BDR:
```
show ip ospf neighbor
```

---

# 19. OSPF Network Types

### Broadcast
- Ethernet
- DR/BDR required
- Multicast Hello → 224.0.0.5

### Nonbroadcast (NBMA)
- Frame Relay / ATM
- No multicast
- Deben configurarse neighbors manualmente

Ejemplo:
```
neighbor 10.1.1.2
neighbor 10.1.1.3
```

### Point-to-Point
- No DR/BDR
- Simple y eficiente

### Point-to-Multipoint
- Similar a p2p pero multipunto
- No DR/BDR

### Loopback
OSPF ve loopbacks como host routes /32.

---

# 20. Failure Detection

OSPF detecta fallas con **Hellos** y **Dead interval**.

Timers por defecto (broadcast):
- Hello: 10 s
- Dead: 40 s

En punto a punto:
- Hello: 10
- Dead: 40

En NBMA:
- Hello: 30
- Dead: 120

Ver timers:
```
show ip ospf interface
```

---

# 21. Verifying OSPF Timers

```
show ip ospf interface g0/0 | include Timer
```

Cambiar timers:
```
interface g0/0
 ip ospf hello-interval 5
 ip ospf dead-interval 20
```

---

# 22. Authentication

Tres tipos:
1. Null (sin autenticación)  
2. Simple password  
3. MD5 (la más común)

Config MD5:
```
interface g0/0
 ip ospf message-digest-key 1 md5 MiClaveOSPF
 ip ospf authentication message-digest
```

Verificar:
```
show ip ospf interface g0/0 | include Auth
```

Si la autenticación no coincide → vecinos quedan en **Init**.

---

# Resumen Final del Capítulo

- OSPF utiliza LSAs para construir un LSDB común.  
- Router-ID es fundamental; define roles en DR/BDR y adyacencias.  
- Áreas reducen complejidad y escalan redes.  
- Adyacencias requieren coincidencia de múltiples parámetros.  
- MTU mismatch muy frecuente en troubleshooting.  
- OSPF soporta múltiples network types, cada uno con comportamiento distinto.  
- DR/BDR solo existen en broadcast y NBMA.  
- Autenticación MD5 recomendada.  
- Default routes requieren `default-information originate`.


# Chapter 8 – Troubleshooting OSPFv2  
## ENARSI Deep Technical Edition

---

# 1. Troubleshooting OSPFv2 Neighbor Adjacencies

Cuando OSPFv2 falla al formar vecinos, revisa primero:

1. Estado físico y L2  
2. Configuración en interfaz  
3. Parámetros que deben coincidir  
4. Problemas típicos: MTU, authentication, area-type, timers  

Comando base:
```
show ip ospf neighbor
```

Estados esperados:
- P2P: FULL  
- Broadcast: FULL solo con DR/BDR  

---

## 1.1 Interface Is Down

Si la interfaz no está UP, OSPF no formará vecinos.

Ver:
```
show ip interface brief
show interface g0/0
```

Solución:
```
interface g0/0
 no shutdown
```

---

## 1.2 Interface Not Running the OSPF Process

Puede ocurrir:

- network statement incorrecto  
- uso de `ip ospf` en interfaz omitiendo ciertas interfaces  

Revisar:
```
show ip ospf interface
show ip ospf interface brief
show run | section ospf
```

Solución:
```
router ospf 1
 network 10.1.1.0 0.0.0.255 area 0
```
o
```
interface g0/0
 ip ospf 1 area 0
```

---

## 1.3 Mismatched Timers

Hello interval y Dead interval deben coincidir:

Ver:
```
show ip ospf interface g0/0
```

Solución:
```
interface g0/0
 ip ospf hello-interval 10
 ip ospf dead-interval 40
```

---

## 1.4 Mismatched Area Numbers

Ejemplo de error:
- R1 interface en area 0  
- R2 interface en area 1  

Ver:
```
show ip ospf interface g0/1 | include Area
```

---

## 1.5 Mismatched Area Type

Áreas deben coincidir en tipo:
- normal  
- stub  
- totally stubby  
- NSSA  
- totally NSSA  

Ver stub flags:
```
show ip ospf
show ip ospf interface g0/0
```

Solución:
```
router ospf 1
 area 1 nssa no-summary
```

---

## 1.6 Different Subnets

OSPF solo forma vecinos si:

- ambas interfaces están en la misma red  
- máscaras coinciden  

Ver:
```
show ip interface g0/0
```

---

## 1.7 Passive Interface

Una interfaz en modo passive **no envía Hellos**.

Ver:
```
show ip ospf | include Passive
```

Solución:
```
router ospf 1
 no passive-interface g0/0
```

---

## 1.8 Mismatched Authentication Information

Si MD5 password no coincide → vecinos quedan en INIT.

Config:
```
interface g0/0
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 cisco123
```

Ver:
```
show ip ospf interface g0/0 | include Auth
```

---

## 1.9 ACLs

ACLs pueden bloquear:

- Hellos → 224.0.0.5  
- DR election → 224.0.0.6  
- LSA updates  

Comprobar:
```
show access-lists
```

---

## 1.10 MTU Mismatch

Uno de los errores más comunes.

Síntoma:
- Vecinos quedan en ExStart/Exchange.

Ver:
```
show ip ospf interface g0/0 | include MTU
```

Solución:
```
interface g0/0
 ip mtu 1500
```

---

## 1.11 Duplicate Router IDs

OSPF requiere Router-ID único.

Ver:
```
show ip ospf | include Router ID
```

Solución:
```
router ospf 1
 router-id 3.3.3.3
```

---

## 1.12 Mismatched Network Types

Si un lado es broadcast y el otro p2p → no hay adyacencia correcta.

Ver:
```
show ip ospf interface g0/0 | include Type
```

Solución:
```
interface g0/0
 ip ospf network point-to-point
```

---

# 2. Troubleshooting OSPFv2 Routes

---

## 2.1 Interface Not Running the OSPF Process

Si la interfaz no está incluida, no se anunciarán rutas.

Ver:
```
show ip ospf interface
```

---

## 2.2 Better Source of Information

OSPF AD = **110**.  
Si existe otra ruta con AD menor (static, EIGRP, connected), OSPF no se instalará.

Ver:
```
show ip route <prefix>
```

Ejemplo:
```
ip route 10.1.1.0 255.255.255.0 Null0 1
```
Esto bloquea las rutas OSPF.

---

## 2.3 Route Filtering

OSPF soporta filtros en ABR:

```
area 1 filter-list prefix BLOCK out
```

Ver:
```
show ip ospf database summary
```

---

## 2.4 Stub Area Configuration

Si un router está configurado como stub pero el ABR no → vecinos no forman adyacencia → no hay rutas.

Ver:
```
show ip ospf
```

---

## 2.5 Interface Is Shut Down

Si la interfaz que participa en el área está apagada:
```
interface g0/1
 shutdown
```

Ver:
```
show ip interface brief
```

---

## 2.6 Wrong Designated Router Elected

DR/BDR afectan flooding y sincronización.

Ver:
```
show ip ospf neighbor
```

Forzar nueva elección:
```
interface g0/0
 ip ospf priority 0
```

---

## 2.7 Duplicate Router IDs

Duplicidad bloquea instalamiento de rutas.

Ver:
```
show ip ospf database router
```

Solución:
```
router ospf 1
 router-id 5.5.5.5
```

---

# 3. Troubleshooting Miscellaneous OSPFv2 Issues

---

## 3.1 Tracking OSPF Advertisements Through a Network

Para ver cómo viaja un LSA:
```
debug ip ospf flooding
debug ip ospf lsa-generation
```

Ver LSDB:
```
show ip ospf database
```

---

## 3.2 Route Summarization

ABR:
```
area 1 range 10.10.0.0 255.255.0.0
```

ASBR:
```
summary-address 192.168.0.0 255.255.0.0
```

Problemas típicos:
- Bloqueo de prefijos legítimos  
- Null0 summary route causando confusión  
- Summaries mal posicionados

---

## 3.3 Discontiguous Areas

Errores comunes:
- El backbone (area 0) queda dividido
- Se necesita Virtual-Link

Ver:
```
show ip ospf database
show ip ospf virtual-links
```

---

## 3.4 Load Balancing

OSPF soporta ECMP:
```
router ospf 1
 maximum-paths 4
```

Verificación:
```
show ip route | include O
```

---

## 3.5 Default Route

Formas de inyectar default:

1. Redistribuir static:
   ```
   ip route 0.0.0.0 0.0.0.0 10.1.1.1
   router ospf 1
    default-information originate
   ```

2. Forzar siempre:
   ```
   default-information originate always
   ```

Ver:
```
show ip route ospf | include 0.0.0.0
```

---

# 4. OSPFv2 Trouble Tickets

---

## Trouble Ticket 8-1  
**Síntoma:** Vecindario no llega a FULL. Se queda en EXSTART.

Probables causas:
- MTU mismatch  
- Router-ID duplicado  
- Authentication mismatch  

Diagnóstico:
```
show ip ospf interface | include MTU
show ip ospf neighbor
```

Solución:
```
interface g0/0
 ip mtu 1500
```

---

## Trouble Ticket 8-2  
**Síntoma:** Rutas inter-area O IA no aparecen.

Diagnóstico:
- ABR no está anunciando Type-3
- Filtro en área
- Área configurada como stub/totally stubby

Ver:
```
show ip ospf database summary
show ip ospf
```

Solución:
```
router ospf 1
 no area 1 stub no-summary
```

---

## Trouble Ticket 8-3  
**Síntoma:** OSPF no está instalando rutas externas.

Posibles causas:
- Redistribución incorrecta  
- External LSAs bloqueadas  
- Filtro en ABR  
- E1/E2 asignación incorrecta  

Ver:
```
show ip ospf database external
```

Solución típica:
```
router ospf 1
 redistribute eigrp 100 subnets
```

---

# Resumen Final del Capítulo

- La mayoría de fallos OSPFv2 vienen de parámetros que deben coincidir: timers, authentication, MTU, stub flags y area type.  
- ExStart → revisar MTU.  
- Init/2-way → revisar authentication y timers.  
- No rutas → revisar AD, filtering y participación de interfaz.  
- DR/BDR afectan flooding y sincronización.  
- Discontiguous area 0 requiere Virtual Links.  
- Summarization mal aplicada produce rutas Null0 inesperadas.


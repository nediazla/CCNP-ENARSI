# Chapter 9 – OSPFv3  

---

# 1. OSPFv3 Fundamentals

OSPFv3 es la versión de OSPF adaptada para IPv6.

Cambios clave respecto a OSPFv2:

1. **Corre sobre IPv6 directamente (protocolo 89)**  
2. **No anuncia direcciones IPv6 en LSAs Tipo 1 y 2**  
   - Se separa topología de direccionamiento.  
3. **Soporta múltiples instancias por enlace**  
4. **Formación de vecinos basada en direcciones link-local**  
5. **Las direcciones de interfaz NO se anuncian como en OSPFv2**  
6. **Autenticación ya no se configura dentro de OSPF**  
   - OSPFv3 usa IPsec AH/ESP, no authentication MD5 nativa.  

Activación global:
```
ipv6 unicast-routing
```

Proceso OSPFv3:
```
ipv6 router ospf <process-id>
```

---

# 2. OSPFv3 Link-State Advertisement

OSPFv3 usa nuevos tipos de LSAs.  
Principales LSAs:

| Tipo | Función | Alcance |
|------|----------|---------|
| 1 | Router-LSA | Área |
| 2 | Network-LSA | Área |
| 3 | Interarea Prefix-LSA | Área |
| 4 | Interarea Router-LSA | Área |
| 5 | External-LSA | AS |
| 7 | NSSA External-LSA | NSSA |
| 8 | Link-LSA | Link-local |
| 9 | Intra-Area Prefix-LSA | Área |

Cambios importantes:

- **IPv6 prefixes se anuncian en LSA Tipo 9**, no en T1/T2 como en OSPFv2.
- LSA Type 8 contiene info vital del enlace: link-local address, options, MTU.

Ver LSDB:
```
show ospfv3 database
```

---

# 3. OSPFv3 Communication

OSPFv3 usa IPv6 multicast:

- Solicitudes de vecino → FF02::5 (AllSPFRouters)  
- DR/BDR → FF02::6 (AllDRouters)

Mensajes:
- Hello
- DBD (Database Description)
- LSR (Link State Request)
- LSU (Link State Update)
- LSAck

Ver Hellos:
```
debug ospfv3 hello
```

---

# 4. OSPFv3 Configuration

Ejemplo básico:

```
ipv6 unicast-routing

ipv6 router ospf 10
 router-id 1.1.1.1

interface g0/0
 ipv6 address 2001:DB8:1::1/64
 ipv6 ospf 10 area 0
```

Nota importante:
- OSPFv3 se habilita **por interfaz**, igual que EIGRPv6.
- No existen network statements como en OSPFv2.

---

# 5. OSPFv3 Verification

Comandos esenciales:

```
show ospfv3 neighbor
show ospfv3 interface
show ospfv3 database
show ospfv3 route
show ipv6 route ospf
```

Ver router-id:
```
show ospfv3 | include Router
```

---

# 6. The Passive Interface

Funciona igual que en OSPFv2, pero aplicado en el proceso OSPFv3:

```
ipv6 router ospf 10
 passive-interface g0/2
```

O hacer todas passive:
```
passive-interface default
no passive-interface g0/0
```

Ver:
```
show ospfv3 interface | include Passive
```

---

# 7. IPv6 Route Summarization (Inter-area & External)

OSPFv3 permite sumarización:

---

## 7.1 Inter-area Summarization (en ABR)

```
ipv6 router ospf 10
 area 1 range 2001:DB8:100::/48
```

Verificar:
```
show ospfv3 database inter-area-prefix
```

---

## 7.2 External Summarization (en ASBR)

```
ipv6 router ospf 10
 summary-prefix 2001:DB8:300::/48
```

Ver:
```
show ospfv3 database external
```

---

# 8. Network Type

OSPFv3 soporta los mismos tipos que OSPFv2:

- broadcast  
- nonbroadcast  
- point-to-point  
- point-to-multipoint  
- loopback  

Config:
```
interface g0/0
 ipv6 ospf network point-to-point
```

Ver:
```
show ospfv3 interface g0/0 | include Network
```

---

# 9. OSPFv3 Authentication

OSPFv2 → autenticación MD5 o simple.  
OSPFv3 → se usa **IPsec AH/ESP**, no autenticación nativa bajo el proceso.

Ejemplo:

```
crypto ipsec transform-set OSPF-SET esp-sha-hmac
crypto map OSPF-MAP 10 ipsec-isakmp
 set peer FE80::2
 set transform-set OSPF-SET
 match address OSPF-ACL
```

Para tráfico OSPF:
- Protocolo 89 en IPv6

A diferencia de OSPFv2:
- No se usa `ip ospf message-digest-key`  
- Todo va vía IPsec

---

# 10. OSPFv3 Link-Local Forwarding

Los vecinos siempre se forman usando **direcciones link-local**.

Ver link-local:
```
show ipv6 interface g0/0 | include FE80
```

Importante:
- Forwarding de paquetes OSPFv3 no usa global unicast.
- Por eso se puede tener múltiples procesos en un enlace sin interferir.

---

# 11. OSPFv3 LSA Flooding Scope

Cada LSA tiene su "scope":

| Scope | Qué abarca |
|--------|---------------|
| Link-local | Solo el enlace |
| Area | Solo el área |
| AS scope | Todo el dominio OSPF |

Ejemplos:
- LSA type 8 → link-local  
- LSA type 1/2/9 → area  
- LSA type 5 → AS  

Ver detalles:
```
show ospfv3 database detail
```

---

# Resumen Final del Capítulo

- OSPFv3 usa IPv6 link-local para adyacencias y corre directamente sobre IPv6.  
- Ya no transporta direcciones IPv6 en LSAs 1/2; usa LSA tipo 9 (Intra-area Prefix).  
- Se configura por interfaz, no con network statements.  
- Autenticación se migra a IPsec, no a comandos internos del proceso.  
- Summarization funciona igual que OSPFv2 (ABR y ASBR).  
- Network types son los mismos que OSPFv2.  
- LSA flooding scope se vuelve más granular en OSPFv3.


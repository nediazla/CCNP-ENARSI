# **Chapter 10 – Troubleshooting OSPFv3**
---

## **10.1 Introducción al Troubleshooting en OSPFv3**

OSPFv3 es la evolución de OSPFv2 para IPv6. Aunque su lógica es similar, introduce diferencias claves que complican el troubleshooting:

- Usa **link-local IPv6** para vecinos.
    
- Se configura en **interfaces**, no mediante network statements.
    
- Soporta **Address Families (AF)**: IPv6 y IPv4.
    
- Usa **instancias**, **instance-id**, y **procesos separados por interfaz**.
    

Cuando algo falla, normalmente se debe a:

- Interface down o sin IPv6.
    
- Falta de link-local.
    
- Authentication ESP/AH.
    
- MTU inconsistente.
    
- Área mal configurada o tipo incorrecto.
    
- Timers incorrectos.
    
- ACL bloqueando multicast.
    
- AF incorrecta o no habilitada.
    

---

## **10.2 Comandos esenciales de Troubleshooting**

```
show ospfv3
show ospfv3 neighbor
show ospfv3 neighbor detail
show ospfv3 interface
show ospfv3 interface brief
show ospfv3 database
show ipv6 route ospf
show ipv6 protocols
debug ospfv3 adj
debug ospfv3 hello
debug ospfv3 events
show ospfv3 address-family ipv6 unicast
```

Cada comando revela un punto crítico del proceso de adyacencia o instalación de rutas.

---

# **10.3 Problemas comunes y cómo diagnosticarlos**

---

## **10.3.1 Interface administratively down**

Síntoma:

- No neighbors.
    
- `show ospfv3 interface` muestra _administratively down_.
    

Diagnóstico:

```
show ospfv3 neighbor
show ospfv3 interface g0/0
```

Corrección:

```
interface g0/0
 no shutdown
```

---

## **10.3.2 Falta de dirección IPv6 o link-local**

OSPFv3 requiere una **link-local** para formar vecinos.

Diagnóstico:

```
show ipv6 interface g0/0
```

Si ves:

```
IPv6 is not enabled, no link-local address
```

Solución:

```
interface g0/0
 ipv6 enable
```
---

## **10.3.3 Mismatched area ID**

Síntoma clásico: los routers ven Hellos pero nunca llegan a FULL.

Diagnóstico:

```
debug ospfv3 hello
```

Solución:

```
interface g0/0
 ospfv3 1 ipv6 area 0
```

---

## **10.3.4 Mismatched area type (stub, nssa, totally)**

Si un router usa area 0 y el otro NSSA, nunca formarán FULL.

Diagnóstico:

```
show ospfv3
show ospfv3 database
```

Solución: igualar tipo de área.

---

## **10.3.5 Timers distintos**

Si los Hellos difieren, OSPFv3 no forma vecinos.

Diagnóstico:

```
show ospfv3 interface g0/0
```

Solución:

```
interface g0/0
 ospfv3 dead-interval 40
 ospfv3 hello-interval 10
```

---

## **10.3.6 Authentication mismatch (IPSec)**

OSPFv3 usa AH/ESP para autenticación.

Síntoma:

- Vecinos quedan en INIT.
    
- Debug muestra _Authentication mismatch_.
    

Diagnóstico:

```
debug ospfv3 adj
```

Corrección: igualar claves y métodos.

---

## **10.3.7 MTU mismatch**

Síntoma típico: routers atascados en **EXSTART/EXCHANGE**.

Diagnóstico:

```
show ospfv3 neighbor detail
```

Solución:

- Igualar MTU **o** ignorarla:
    

```
interface g0/0
 ip mtu 1500
```

---

## **10.3.8 Duplicate Router-ID**

OSPFv3 usa un Router-ID independiente del IPv6.

Diagnóstico:

```
show ospfv3 | include Router ID
```

Solución:

```
router ospfv3 1
 router-id 1.1.1.1
```

---

## **10.3.9 ACL bloqueando OSPFv3 multicast**

Debe permitirse ff02::5 (Hello) y ff02::6 (LSA Updates).

Diagnóstico:

```
show access-lists
```

Solución:

```
permit ipv6 any ff02::5
permit ipv6 any ff02::6
```

---

## **10.3.10 Passive Interface**

Un passive interface **no envía Hellos**, por lo tanto no forma vecinos.

Solución:

```
router ospfv3 1
 no passive-interface g0/0
```

---

# **10.4 Troubleshooting de Rutas OSPFv3**

---

## **10.4.1 Interfaz no participa en OSPFv3**

Diagnóstico:

```
show ospfv3 interface g0/0
```

Corregir:

```
interface g0/0
 ospfv3 1 ipv6 area 0
```

---

## **10.4.2 Mejor fuente de información (AD más baja)**

Si no ves rutas OSPF, puede estar ganando:

- Static (AD 1)
    
- Connected (AD 0)
    
- EIGRP external (AD 170)
    

Diagnóstico:

```
show ipv6 route
```

---

## **10.4.3 Route Filtering en OSPFv3**

Las route-maps y prefix-lists pueden bloquear rutas.

Diagnóstico:

```
show ospfv3 database
```

---

## **10.4.4 Stub Area Configuration incorrecta**

Síntoma:

- Recibes LSA Type 5 en un stub.
    

Solución:

Asegurar que todos los routers en esa área son stub:

```
router ospfv3 1
 area 1 stub
```

---

## **10.4.5 Problemas con Summarization**

Diagnóstico:

```
show ospfv3 database
```

Solución:

```
router ospfv3 1
 area 1 range 2001:db8:100::/48
```

---

# **10.5 Troubleshooting OSPFv3 Address Families**

OSPFv3 puede manejar IPv4 e IPv6 simultáneamente, pero un fallo común es:

- AF IPv6 no activada
    
- Interface no unida al AF
    
- Instance-id incorrecto
    

Configuración válida:

```
router ospfv3 10
 address-family ipv6 unicast
 exit-af
```
En la interfaz:

```
interface g0/0
 ospfv3 10 ipv6 area 0
```

---

# **10.6 OSPFv3 Trouble Tickets**

---

## **Trouble Ticket 10-1 – No adjacency**

Síntoma:

- No neighbors
    
- Debug: _Mismatched instance ID_
    

Solución:

```
interface g0/0
 ospfv3 1 instance-id 0
```

---

## **Trouble Ticket 10-2 – Estado EXSTART**

Síntoma:

- Vecinos quedan en EXSTART
    
- Debug indica MTU mismatch
    

Solución:

```
interface g0/0
 mtu 1500
```

---

## **Trouble Ticket 10-3 – No rutas IPv6**

Síntoma:

- `show ipv6 route ospf` vacío
    
- AF IPv6 no habilitada
    

Solución:

```
router ospfv3 20
 address-family ipv6 unicast
 exit-af
```
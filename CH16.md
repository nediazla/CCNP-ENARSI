# **Capítulo 16 – Route Redistribution**

---

La redistribución permite que rutas aprendidas por un protocolo (OSPF, EIGRP, BGP, RIP…) se importen a otro.  
Es extremadamente poderosa, pero también peligrosa si se hace mal: puede generar **loops**, **routing inconsistente** y **inundaciones de LSAs**.

Este capítulo explica cómo redistribuir correctamente, cómo funcionan los _seed metrics_, qué comportamientos son específicos por protocolo, y cómo evitar problemas típicos del examen.

---

# **1. Redistribution Overview**

Redistribución = tomar rutas de un protocolo de enrutamiento y **anunciarlas** como rutas válidas dentro de otro protocolo.

Ejemplo conceptual:

```
EIGRP → OSPF
OSPF → BGP
Connected → EIGRP
Static → OSPF
```

Redistribuir es necesario cuando:

- Se combinan redes con protocolos diferentes.
    
- Se integran adquisiciones empresariales.
    
- Se usan protocolos especializados por dominio (ej: OSPF interno, BGP externo).
    

---

# **2. Redistribution Is Not Transitive**

Importante y verificable:

**Si un protocolo aprende rutas redistribuidas desde otro, NO redistribuye esas rutas automáticamente hacia terceros.**

Ejemplo:

```
EIGRP <- OSPF <- RIP
```

RIP → OSPF, pero OSPF **no reenviará automáticamente** rutas RIP a EIGRP.  
Debe configurarse explícitamente.

---

# **3. Sequential Protocol Redistribution**

Cuando se redistribuyen varios protocolos, el orden importa.

Ejemplo:

```
router ospf 1
 redistribute eigrp 100
 redistribute bgp 65000
```

OSPF procesará primero rutas EIGRP y luego BGP, lo cual afecta:

- Conflictos de métricas
    
- Rutas más preferidas
    
- Reglas de filtrado
    

Es buena práctica usar **route-maps** para controlar cada origen:

```
redistribute eigrp 100 route-map FROM-EIGRP
redistribute bgp 65000 route-map FROM-BGP
```

---

# **4. Routes Must Exist in the RIB**

Una ruta solo puede redistribuirse si existe en la tabla RIB:

```
show ip route
```

Si la ruta no está instalada (ej: por no ser best path), no se redistribuirá.

---

# **5. Seed Metrics**

Cuando un protocolo importa rutas desde otro, esas rutas necesitan un **seed metric** inicial.

Los seed metrics dependen del protocolo:

|Protocolo|Seed Metric si no se especifica|
|---|---|
|**EIGRP**|Infinity (no redistribuye)|
|**OSPF**|Cost = 20 (para external type 2), a menos que venga de BGP (E2 cost = 1)|
|**RIP**|Hop count = 1|
|**BGP**|MED = 0|

Si el seed metric no es adecuado, la ruta puede volverse **inútil** para los vecinos o causar loops.

---

# **6. Protocol-Specific Configuration**

Cada protocolo requiere su propia sintaxis de redistribución.

Ejemplo general:

```
router ospf 1
  redistribute eigrp 100 metric 10 subnets
```

OSPF requiere `subnets` para redistribuir redes no claseful.

---

# **7. Source-Specific Behaviors**

Diferentes protocolos agregan atributos distintos al redistribuir.

---

## **7.1 Connected Networks**

Las interfaces conectadas pueden redistribuirse directamente:

```
redistribute connected
```

Pero es más seguro usar route-maps:

```
route-map ONLY-LOOPBACK permit 10
 match interface Loopback0

router ospf 1
 redistribute connected route-map ONLY-LOOPBACK
```

---

## **7.2 BGP**

Redistribuir rutas hacia BGP se hace normalmente para:

- Enviar rutas internas hacia un ISP.
    
- Añadir rutas de IGP al dominio BGP.
    

Ejemplo:

```
router bgp 65000
 redistribute ospf 1
```

Importante:

- Los prefijos deben existir en la RIB.
    
- Las rutas redistribuidas se convierten en **incomplete** (`?`) en el atributo ORIGIN.
    
- Es común manipular atributos como MED, LP o COMMUNITIES.
    

---

# **8. Destination-Specific Behaviors**

Cada protocolo maneja rutas externas de manera distinta.

---

## **8.1 EIGRP**

EIGRP utiliza **composite metrics**, pero rutas redistribuidas reciben un **seed metric** manual.

Ejemplo clásico:

```
router eigrp 100
 redistribute ospf 1 metric 10000 100 255 1 1500
```

Parámetros:

1. Bandwidth
    
2. Delay
    
3. Reliability
    
4. Load
    
5. MTU
    

Si no se especifican → **metric infinity → no se usan**.

---

# **9. EIGRP-to-EIGRP Redistribution**

En dominios separados de EIGRP:

- EIGRP ASN debe diferir
    
- Las rutas redistribuidas se consideran **externas (EX)**
    
- EX tienen métricas distintas y menos preferidas que internas
    

Ejemplo:

```
router eigrp 1
 redistribute eigrp 2 metric 10000 10 255 1 1500
```

---

# **10. OSPF**

OSPF puede redistribuir rutas externas como:

- **Type E2** (default):  
    Cost = 20, no se incrementa.
    
- **Type E1**:  
    Cost incrementa con el costo interno al ASBR.  
    Más útil para control granular.
    

Ejemplo:

```
redistribute eigrp 100 metric 10 subnets
```

---

# **11. OSPF-to-OSPF Redistribution**

OSPF no redistribuye automáticamente entre áreas.

Ejemplo:

```
OSPF Area 0 ←→ OSPF Area 1 (redes separadas)
```

Una redistribución entre dos procesos OSPF diferentes convierte rutas en **OSPF external routes**.

Ejemplo de comandos:

```
router ospf 10
 redistribute ospf 20 subnets metric-type 1
```

Recomendaciones:

- Evitar redistribución recíproca (OSPF->OSPF->OSPF)
    
- Controlar con route-maps y tags
    

---

# **12. OSPF Forwarding Address**

En redistribución OSPF, el **Forwarding Address (FA)** aparece en LSA tipo 5 cuando:

1. El ASBR recibe la ruta de un vecino **no-OSPF**, y
    
2. El next-hop es accesible dentro del área OSPF.
    

El FA evita tránsito innecesario por el ASBR, permitiendo que routers internos envíen tráfico directo.

Si las condiciones no se cumplen, FA = 0.0.0.0.

---

# **13. BGP (Redistribution into IGP)**

Redistribuir BGP hacia un IGP debe hacerse con extremo cuidado.

Riesgos:

- Inundación masiva de prefijos BGP (miles)
    
- Colapso del IGP
    
- Loops
    
- Oscilación en convergencia
    

Prácticas recomendadas:

- Restringir prefijos con route-maps
    
- No redistribuir BGP full table hacia OSPF/EIGRP
    
- Preferir sumarización antes de redistribuir
    
- En MPLS/VPN, usar RR y no redistribución directa
    

Ejemplo seguro:

```
route-map BGP-INTO-OSPF permit 10
 match ip address prefix-list SAFE-BGP
 set metric 50

router ospf 1
 redistribute bgp 65000 subnets route-map BGP-INTO-OSPF
```

---

# **RESUMEN FINAL DEL CAPÍTULO**

Este capítulo establece los elementos clave de redistribución:

- Redistribución **no es transitiva**
    
- Las rutas deben existir en la **RIB**
    
- Cada protocolo requiere **seed metrics**
    
- OSPF: E1/E2, forwarding address, subnets obligatorio
    
- EIGRP: composite metrics obligatorios
    
- BGP: rutas se marcan ORIGIN `?`
    
- Redistribuir BGP hacia IGP es peligroso → siempre filtrar
    
- Evitar redistribuciones recíprocas
    
- Usar route-maps para control granular
    

Dominar estas reglas es esencial para cualquier escenario de diseño o solución de problemas en ENARSI.
# **Capítulo 17 – Troubleshooting Redistribution**

---

La redistribución es una de las áreas más delicadas del enrutamiento avanzado.  
Cuando se redistribuyen rutas entre protocolos, pueden aparecer problemas como:

- Rutas subóptimas
    
- Loops
    
- Falta de rutas
    
- Métricas incorrectas
    
- Inundaciones en OSPF
    
- Exceso de rutas externas
    
- Preferencia inesperada de rutas
    

Este capítulo explica cómo diagnosticar y corregir esos problemas.

---

# **1. Troubleshooting Advanced Redistribution Issues**

Los problemas avanzados de redistribución normalmente involucran:

- **Seed metrics incorrectas**
    
- **Falta de filtrado**
    
- **Redistribución mutua (bidireccional)**
    
- **Redistribución transitiva no deseada**
    
- **Next-hop no alcanzable**
    
- **Problemas de sumarización**
    
- **Políticas de route-maps mal aplicadas**
    

Herramientas principales:

```
show ip route
show ip protocols
show ip ospf database
show ip eigrp topology
show bgp <prefix>
debug ip routing
```
---

# **2. Troubleshooting Suboptimal Routing Caused by Redistribution**

Cuando una red usa múltiples protocolos, es común que el tráfico elija rutas incorrectas debido a:

### **2.1 Métricas incompatibles**

Cada protocolo usa una métrica distinta:

- EIGRP: composite metric
    
- OSPF: cost
    
- RIP: hop count
    
- BGP: attributes (LP, AS_PATH, MED…)
    

Al redistribuir, si las métricas no se ajustan adecuadamente, pueden producirse rutas subóptimas.

### **2.2 Redistribución recíproca**

Ejemplo:

```
EIGRP → OSPF → EIGRP
```

Esto crea “rutas que regresan al origen”, provocando saltos innecesarios.

### **2.3 Soluciones**

- Ajustar métricas manualmente
    
- Aplicar filtros (route-maps/prefix-lists)
    
- Utilizar summarización
    
- Ingresar políticas de preferencia (LP, MED)
    

---

# **3. Troubleshooting Routing Loops Caused by Redistribution**

El peor escenario: **loops entre dominios**.

Los loops aparecen cuando:

1. Protocolos se redistribuyen mutualmente sin filtrado
    
2. No se utilizan etiquetas o tags de redistribución
    
3. Sumarización incorrecta crea falsas rutas válidas
    
4. Métricas inapropiadas hacen que rutas externas parezcan mejores
    

### **3.1 Uso de tags para evitar loops**

```
route-map TAG-EIGRP permit 10
 set tag 100

router ospf 1
 redistribute eigrp 100 subnets route-map TAG-EIGRP
```

Y luego evitar reimportarlas:

```
route-map BLOCK-TAG deny 10
 match tag 100
```

---

# **4. Troubleshooting IPv4 and IPv6 Redistribution**

Problemas comunes:

### **4.1 Falta de “subnets” en OSPF**

En IPv4:

```
redistribute connected metric 10
```

Sin `subnets` solo redistribuye redes classful.

### **4.2 OSPFv3 usa address families**

Ejemplo:

```
router ospfv3 1
 address-family ipv6 unicast
  redistribute bgp 65000
```

### **4.3 Next-hop IPv6 incorrecto**

OSPFv3 y EIGRPv6 requieren next-hops válidos para instalar rutas.

### **4.4 Protocolo origen no instala rutas**

Si la ruta no está en RIB, no se redistribuye.

---

# **5. Route Redistribution Review**

Resumen esencial:

- Redistribución no es transitiva
    
- Las rutas deben existir en RIB
    
- Cada protocolo requiere seed metrics
    
- Deben usarse route-maps para control
    
- Deben evitarse redistribuciones recíprocas
    
- Los tags evitan loops
    
- OSPF requiere subnets
    
- EIGRP requiere 5 valores de métrica
    
- BGP márcalas como “incomplete” si se redistribuye desde IGP
    
- Cuidado con:
    
    - Next-hop
        
    - Métrica interna
        
    - Política incorrecta
        

---

# **6. Troubleshooting Redistribution into EIGRP**

Problemas típicos:

### **6.1 Faltan los parámetros de métrica**

```
redistribute ospf 1
```

Esto no funciona porque EIGRP requiere los 5 valores:

```
redistribute ospf 1 metric 10000 10 255 1 1500
```

### **6.2 Loops internos**

Especialmente si se redistribuye EIGRP ↔ OSPF.

### **6.3 EIGRP no instala rutas externas**

Puede deberse a:

- Métrica demasiado alta
    
- Falta de next-hop
    
- Falta de filtrado
    
- Rutas internas preferidas
    

---

# **7. Troubleshooting Redistribution into OSPF**

Problemas comunes:

### **7.1 Falta de “subnets”**

Sin esto, muchas rutas no se redistribuyen.

### **7.2 Tipo incorrecto de external**

E2 versus E1:

- **E2** → cost fijo
    
- **E1** → cost = cost externo + cost interno
    

E1 suele evitar subóptimos.

### **7.3 Forwarding Address incorrecto**

OSPF no instala rutas si el FA no es alcanzable.

### **7.4 LSA overflow**

Redistribuir demasiadas rutas puede saturar el dominio.

---

# **8. Troubleshooting Redistribution into BGP**

Problemas típicos:

### **8.1 Rutas no aparecen en BGP**

Porque:

- No están en RIB
    
- Route-map bloquea
    
- Se necesitan filtros más precisos
    

### **8.2 Se está exportando demasiado hacia BGP**

Nunca redistribuir un IGP completo hacia Internet.

### **8.3 ORIGIN incorrecto**

Rutas redistribuidas tienen origen `?`, afectando el best-path.

### **8.4 Next-hop self faltante**

Si iBGP no agrega next-hop-self, rutas no se instalan.

---

# **9. Troubleshooting Redistribution with Route Maps**

Problemas comunes:

### **9.1 ACL o prefix-list mal escrita**

La lógica del route-map depende del match correcto.

### **9.2 Secuencia incorrecta**

Un deny en secuencia baja puede bloquear todo.

### **9.3 Falta de “permit 20” para otros prefijos**

Route-map con una sola secuencia permit 10 actúa como un filtrado total.

### **9.4 No se aplicó el route-map en el comando de redistribución**

Muy común:

```
redistribute connected
```

Pero olvidan:

```
route-map FILTRO-IN
```

---

# **10. Redistribution Trouble Tickets**

---

## **Trouble Ticket 17-1 — Rutas OSPF No Llegan a EIGRP**

Síntomas:

- Rutas externas EIGRP no aparecen en OSPF
    
- seed metric ausente
    
- redistribución sin subnets
    

Solución:

```
redistribute ospf 1 metric 10000 10 255 1 1500 subnets
```

---

## **Trouble Ticket 17-2 — Loop entre OSPF y EIGRP**

Síntoma:

- Rutas entran y salen de ambos protocolos
    
- Rutas duplicadas
    
- Latencia alta
    
- Inconsistencia
    

Solución:

- Usar tags
    
- Usar summarización en límites
    
- Usar E1 para preferencia correcta
    

---

## **Trouble Ticket 17-3 — BGP no Recibe Rutas Redistribuidas**

Posibles causas:

- RIB no tiene la ruta original
    
- route-map filtra rutas
    
- next-hop no alcanzable
    
- procesos BGP no refrescados
    

Verificar:

```
show ip bgp
show ip bgp neighbors <IP> received-routes
```

---

## **Trouble Ticket 17-4 — Rutas IPv6 No Redistribuidas**

Causas:

- Redistribución no configurada dentro del address-family
    
- Rutas no existen como IPv6 en RIB
    
- Prefijos filtrados por prefix-list IPv6
    
- Next-hop IPv6 incorrecto
    

Ejemplo correcto:

```
router ospfv3 1
 address-family ipv6 unicast
  redistribute bgp 65000
```
---

# **Resumen Final del Capítulo**

Este capítulo enseña cómo diagnosticar problemas complejos en redistribución:

- Rutas no distribuidas por falta de seed metrics
    
- Loops provocados por redistribución recíproca
    
- Subóptimos por incompatibilidades de métrica
    
- Problemas en next-hop, filtrado o forwarding address
    
- Redistribución IPv6 requiere address-family
    
- BGP necesita rutas instaladas en RIB
    
- Route-maps son esenciales para control
    
- Tags evitan loops severos
    
- Ejemplos de casos reales (trouble tickets)
    

Dominar este capítulo te permitirá resolver el 90% de fallos de redistribución en entornos complejos de red.
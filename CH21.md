# **Capítulo 21 – Troubleshooting ACLs and Prefix Lists**

---

Los **ACLs** y **prefix-lists** son herramientas esenciales para filtrado, redistribución, PBR, BGP, DMVPN, QoS y políticas de seguridad.  
Este capítulo se enfoca en cómo **leer, interpretar y solucionar problemas** relacionados con estas herramientas, ya que errores pequeños generan fallos críticos.

---

# **1. Troubleshooting IPv4 ACLs**

La causa más común de errores en ACLs es una incorrecta interpretación de:

- Orden de líneas
    
- Wildcard masks
    
- Implícito “deny any”
    
- Posición incorrecta en interfaz
    
- Dirección incorrecta (in/out)
    
- Matching demasiado amplio o demasiado específico
    

Comandos de diagnóstico:

```
show access-lists
show ip interface <name>
debug ip packet detail
```

---

# **2. Reading an IPv4 ACL**

Ejemplo:

```
access-list 101 permit tcp 10.1.0.0 0.0.255.255 any eq 80
access-list 101 deny   ip any any
```

Interpretación:

- Primera línea: tráfico TCP desde 10.1.0.0/16 destino cualquier dirección puerto 80
    
- Segunda línea: todo lo demás denegado
    

Notas importantes:

- ACLs se procesan de arriba hacia abajo
    
- El primer match **gana**
    
- Si no coincide → se aplica deny implícito
    

---

# **3. Using an IPv4 ACL for Filtering**

ACL aplicada en interfaz:

```
interface GigabitEthernet0/1
 ip access-group 101 in
```

Direcciones:

- **in** → filtra tráfico que entra a la interfaz
    
- **out** → filtra tráfico que sale de la interfaz
    

Errores comunes:

- Aplicar ACL en la dirección equivocada
    
- Filtrar tráfico de control-plane (BGP/OSPF) sin querer
    
- Usar ACL estándar donde se necesita extended
    

---

# **4. Using a Time-Based IPv4 ACL**

Permite filtrado según horarios:

```
time-range WORK-HOURS
 periodic weekdays 9:00 to 17:00

access-list 101 permit tcp any any eq 22 time-range WORK-HOURS
```

Problemas comunes:

- Hora del sistema incorrecta
    
- Time-range no referenciado en ACL
    
- Time-range expirado
    

Verificación:

```
show time-range
```

---

# **5. Troubleshooting IPv6 ACLs**

Similares a IPv4 pero con diferencias clave:

- No hay wildcard masks
    
- Sintaxis es más explícita
    
- Última línea implícita → deny ipv6 any any
    
- Prefijos usualmente más largos
    
- Deben soportar ICMPv6 obligatoriamente (sin ICMPv6, IPv6 NO funciona)
    

Errores típicos:

- Bloquear Neighbor Discovery
    
- Bloquear ICMPv6 importante (RA, RS, ND, MLD)
    
- Confundir "::/0" con "::"
    

---

# **6. Reading an IPv6 ACL**

Ejemplo:

```
ipv6 access-list BLOCK-SSH
 deny tcp any any eq 22
 permit ipv6 any any
```

No existe wildcard, solo prefijos explícitos.

Verificación:

```
show ipv6 access-list
```

---

# **7. Using an IPv6 ACL for Filtering**

Aplicación:

```
interface GigabitEthernet0/0
 ipv6 traffic-filter BLOCK-SSH in
```

Problemas comunes:

- Usar `ip access-group` en lugar de `ipv6 traffic-filter`
    
- No permitir ICMPv6 → conexiones fallan
    
- Orden incorrecto en ACL
    

---

# **8. Troubleshooting Prefix Lists**

Los prefix-lists se usan sobre todo en:

- BGP
    
- Redistribución
    
- Route-maps
    
- Control de sumarización
    
- HSRP/VRRP tracking
    

Errores comunes:

- Confundir ge/le
    
- Prefijos demasiado amplios
    
- No tener secuencia de permit/deny correcta
    
- Deny final implícito no deseado
    
- Longitudes incorrectas del prefijo
    

Verificación:

```
show ip prefix-list
```

---

# **9. Reading a Prefix List**

Ejemplo:

```
ip prefix-list LOCAL-NETS seq 5 permit 10.0.0.0/8 le 24
```

Interpretación:

- Coinciden redes dentro de 10.0.0.0/8
    
- Con prefijos de /8 **hasta /24**
    
- Ej: 10.1.1.0/24 coincide
    
- Ej: 10.1.1.0/25 NO coincide
    

---

# **10. Prefix List Processing**

Reglas de funcionamiento:

1. Se procesan de arriba abajo
    
2. La primera coincidencia decide
    
3. Si ninguna línea coincide → **deny implícito**
    
4. ge X = longitud >= X
    
5. le X = longitud <= X
    

Ejemplo de error común:

```
ip prefix-list TEST permit 0.0.0.0/0 ge 8
```

Esto coincide prácticamente con **todo**, creando filtrados incorrectos.

---

# **11. Trouble Tickets**

---

## **Trouble Ticket 21-1: IPv4 ACL Trouble Ticket**

### **Síntoma**

OSPF o BGP no forma adyacencia.

### **Causa probable**

ACL bloquea:

- Multicast OSPF 224.0.0.5 / 224.0.0.6
    
- TCP 179 (BGP)
    
- ICMP (necesario para MTU)
    

### **Solución**

Permitir protocolos esenciales:

```
access-list 101 permit ospf any any
access-list 101 permit tcp any any eq 179
access-list 101 permit icmp any any
```

---

## **Trouble Ticket 21-2: IPv6 ACL Trouble Ticket**

### **Síntoma**

Clientes IPv6 no se comunican ni obtienen autoconfiguración.

### **Causa probable**

ACL bloquea ICMPv6 necesario:

- Router Advertisements
    
- Router Solicitations
    
- Neighbor Discovery
    
- MLD
    

### **Solución**

Agregar:

```
permit icmpv6 any any neighbor-solicitation
permit icmpv6 any any neighbor-advertisement
permit icmpv6 any any router-advertisement
permit icmpv6 any any router-solicitation
```

---

## **Trouble Ticket 21-3: Prefix List Trouble Ticket**

### **Síntoma**

Proveedor rechaza anuncios BGP o no llegan rutas internas.

### **Causas posibles**

- ge/le incorrectos
    
- Prefijo demasiado específico
    
- Prefijo no permitido por política ISP
    
- Secuencias deny antes de permit
    
- Match accidental con prefix demasiado amplio
    

### **Solución**

Verificar secuencia con:

```
show ip prefix-list <name>
```

Ejemplo de corrección:

```
ip prefix-list EXPORT seq 5 permit 203.0.113.0/24
ip prefix-list EXPORT seq 10 deny 0.0.0.0/0 le 32
```

---

# **Resumen Final del Capítulo**

Este capítulo cubre la comprensión profunda y solución de problemas con ACLs y prefix-lists:

### **IPv4 ACLs**

- Wildcard masks
    
- Orden secuencial
    
- Aplicación in/out
    
- Time-based ACLs
    

### **IPv6 ACLs**

- Sin wildcards
    
- ICMPv6 obligatorio
    
- Syntax ampliada
    

### **Prefix Lists**

- ge/le
    
- Procesamiento secuencial
    
- Filtrado preciso para BGP
    

### **Troubleshooting general**

- Leer ACL/prefix-list de arriba a abajo
    
- Identificar implícitos deny
    
- Revisar interfaces y direcciones
    
- Usar comandos de verificación apropiados
    

Dominar estos conceptos es esencial para seguridad, BGP, redistribución, VPNs, DMVPN y prácticamente cualquier tecnología avanzada del examen ENARSI.